import datetime
import urllib.request
import json

URL = "https://filippo.io/linux-syscall-table/TABELLA_64.json"
DATE = datetime.datetime.utcnow().isoformat()

request = urllib.request.urlopen(URL)
data = json.load(request)
#print(data)

print(f'''// Code generated by go generate; DO NOT EDIT
// This file was generated by robots at
// { DATE }
// using data from
// { URL }

// +build linux

package syscall
''')

print("var codeToName = map[uint64]string{")
for elem in data.values():
    code, name, entry_point, impl, arguments = elem
    print(f"  {code} : \"{name}\",")
print("}")

print("var nameToCode = map[string]uint64{")
for elem in data.values():
    code, name, entry_point, impl, arguments = elem
    print(f"  \"{name}\" : {code},")
print("}")

print("var codeToArgTypes = map[uint64][]string{")
for elem in data.values():
    code, name, entry_point, impl, arguments = elem
    if not arguments:
      continue
    argument_types = ", ".join([
      "\"" + arg[0] + "\""
      for arg in arguments
    ])
    print(f"  {code} : {{{argument_types}}},")
print("}")

print('''
func GetSyscallName(code uint64) string {
  return codeToName[code]
}

func GetSyscallArgumentTypes(code uint64) []string {
  return codeToArgTypes[code]
}

''')